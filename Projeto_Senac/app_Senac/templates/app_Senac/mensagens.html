{% extends 'app_Senac/base.html' %}
{% load static %}

{% block title %}
    {% if page_title %}{{ page_title }}{% else %}Mensagens Recebidas - Admin Senac{% endif %}
{% endblock %}

{% block content %}
<div class="container">
    <h1>{% if page_title %}{{ page_title }}{% else %}Mensagens de Contato Recebidas (Admin){% endif %}</h1>
    
    <section id="lista-mensagens">
        {% if lista_mensagens_contato %} 
            <p>Total de mensagens: {{ lista_mensagens_contato|length }}</p>
            <div class="admin-table-responsive">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Remetente</th>
                            <th>E-mail</th>
                            <th>Assunto</th>
                            <th>Data Envio</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for msg in lista_mensagens_contato %} 
                        <tr class="{% if not msg.lida %}fw-bold{% endif %}"> <td>{{ msg.nome }}</td>
                            <td>{{ msg.email }}</td>
                            <td>
                                <a href="#" title="{{ msg.mensagem|truncatewords_html:50 }}" data-bs-toggle="tooltip" data-bs-placement="top">
                                    {{ msg.assunto|truncatechars:40 }}
                                </a>
                                <small style="display: block; color: #6c757d; margin-top: 5px;"><em>Preview: {{ msg.mensagem|truncatewords:10 }}</em></small>
                            </td>
                            <td>{{ msg.data_envio|date:"d/m/Y H:i" }}</td>
                            <td>
                                {% if msg.lida %}
                                    <span class="badge bg-success">Lida</span>
                                {% else %}
                                    <span class="badge bg-warning text-dark">Não Lida</span>
                                {% endif %}
                            </td>
                            <td class="actions">
                                <form method="post" action="{% url 'excluir_mensagem' msg.id %}" style="display: inline;" onsubmit="return confirm('Tem certeza que deseja excluir esta mensagem?');">
                                    {% csrf_token %}
                                    <button type="submit" class="button-link button-danger btn-sm">Excluir</button>
                                </form>
                            </td>
                        </tr>
                        {% empty %} <tr>
                            <td colspan="6" class="text-center">Nenhuma mensagem recebida ainda.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %} <p class="mt-3">Nenhuma mensagem recebida ainda (bloco else do if).</p>
        {% endif %}
    </section>
</div>
{% endblock %}